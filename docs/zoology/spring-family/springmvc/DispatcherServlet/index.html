<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link rel="alternate" type="application/rss+xml" href="/docs.advanced.way/blog/rss.xml" title="è¿›é˜¶ä¹‹è·¯ Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs.advanced.way/blog/atom.xml" title="è¿›é˜¶ä¹‹è·¯ Blog Atom Feed"><title data-react-helmet="true">DispatcherServlet | è¿›é˜¶ä¹‹è·¯</title><meta data-react-helmet="true" property="og:url" content="https://Goldwood1024.github.io/docs.advanced.way/docs/zoology/spring-family/springmvc/DispatcherServlet"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="DispatcherServlet | è¿›é˜¶ä¹‹è·¯"><meta data-react-helmet="true" name="description" content="DispatcherServlet"><meta data-react-helmet="true" property="og:description" content="DispatcherServlet"><link data-react-helmet="true" rel="shortcut icon" href="/docs.advanced.way/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://Goldwood1024.github.io/docs.advanced.way/docs/zoology/spring-family/springmvc/DispatcherServlet"><link data-react-helmet="true" rel="alternate" href="https://Goldwood1024.github.io/docs.advanced.way/docs/zoology/spring-family/springmvc/DispatcherServlet" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://Goldwood1024.github.io/docs.advanced.way/docs/zoology/spring-family/springmvc/DispatcherServlet" hreflang="x-default"><link rel="stylesheet" href="/docs.advanced.way/assets/css/styles.5e159b62.css">
<link rel="preload" href="/docs.advanced.way/assets/js/runtime~main.871cb501.js" as="script">
<link rel="preload" href="/docs.advanced.way/assets/js/main.9348fd2a.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs.advanced.way/"><img src="/docs.advanced.way/img/logo.svg" alt="è¿›é˜¶ä¹‹è·¯ Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/docs.advanced.way/img/logo.svg" alt="è¿›é˜¶ä¹‹è·¯ Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">è¿›é˜¶ä¹‹è·¯</strong></a><a class="navbar__item navbar__link" href="/docs.advanced.way/docs/java/">Java</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">ç”Ÿæ€</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs.advanced.way/docs/zoology/spring-family/">Springå®¶æ—</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/zoology/framework/mybatis/">å¸¸ç”¨æ¡†æ¶</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/zoology/distributed/">åˆ†å¸ƒå¼</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/zoology/cloud/docker/base/é•œåƒ/">å®¹å™¨</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/zoology/db/mysql/InnoDB/">æ•°æ®åº“</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/zoology/os/network/tcpip/">è®¡ç®—æœºç³»ç»Ÿ</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">ç¼–ç å®è·µ</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs.advanced.way/docs/algorithm/algorithm/">ç®—æ³•/æ•°æ®ç»“æ„</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/patterns/">è®¾è®¡æ¨¡å¼</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/architecture/">ç³»ç»Ÿæ¶æ„</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/practice/memo/tool/sublime/">å¤‡å¿˜å½•</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs.advanced.way/blog">åšå®¢</a><a href="https://github.com/Goldwood1024/docs.advanced.way.git" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docs.advanced.way/"><img src="/docs.advanced.way/img/logo.svg" alt="è¿›é˜¶ä¹‹è·¯ Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/docs.advanced.way/img/logo.svg" alt="è¿›é˜¶ä¹‹è·¯ Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">è¿›é˜¶ä¹‹è·¯</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/java/">Java</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">ç”Ÿæ€</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs.advanced.way/docs/zoology/spring-family/">Springå®¶æ—</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/zoology/framework/mybatis/">å¸¸ç”¨æ¡†æ¶</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/zoology/distributed/">åˆ†å¸ƒå¼</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/zoology/cloud/docker/base/é•œåƒ/">å®¹å™¨</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/zoology/db/mysql/InnoDB/">æ•°æ®åº“</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/zoology/os/network/tcpip/">è®¡ç®—æœºç³»ç»Ÿ</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">ç¼–ç å®è·µ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/algorithm/algorithm/">ç®—æ³•/æ•°æ®ç»“æ„</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/patterns/">è®¾è®¡æ¨¡å¼</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/architecture/">ç³»ç»Ÿæ¶æ„</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/practice/memo/tool/sublime/">å¤‡å¿˜å½•</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/blog">åšå®¢</a></li><li class="menu__list-item"><a href="https://github.com/Goldwood1024/docs.advanced.way.git" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/docs.advanced.way/"><img src="/docs.advanced.way/img/logo.svg" alt="è¿›é˜¶ä¹‹è·¯ Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/docs.advanced.way/img/logo.svg" alt="è¿›é˜¶ä¹‹è·¯ Logo" class="themedImage_1VuW themedImage--dark_hz6m"><strong>è¿›é˜¶ä¹‹è·¯</strong></a><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Spring</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/">Spring Family</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/spring/IOC">IOC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/spring/AOP">AOP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/spring/core">Spring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/spring/äº‹åŠ¡ç®¡ç†">äº‹åŠ¡ç®¡ç†</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/spring/BeanFactory">BeanFactory</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/spring/BeanDefinition">BeanDefinition</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/spring/springå¯åŠ¨æµç¨‹">å¯åŠ¨æµç¨‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/spring/é—®é¢˜">å¸¸è§é—®é¢˜</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/spring/importbean">æ³¨å…¥Beançš„æ–¹å¼</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/spring/getbean">è·å–ä¸Šä¸‹æ–‡çš„Bean</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">SpringMVC</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs.advanced.way/docs/zoology/spring-family/springmvc/ç®€ä»‹">ç®€ä»‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs.advanced.way/docs/zoology/spring-family/springmvc/æ ¸å¿ƒç»„ä»¶">æ ¸å¿ƒç»„ä»¶</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs.advanced.way/docs/zoology/spring-family/springmvc/Servlet">Servlet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs.advanced.way/docs/zoology/spring-family/springmvc/Session">Session</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs.advanced.way/docs/zoology/spring-family/springmvc/DispatcherServlet">DispatcherServlet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs.advanced.way/docs/zoology/spring-family/springmvc/RequestMapping">@RequestMapping</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SpringBoot</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/springboot/ç®€ä»‹">ç®€ä»‹</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/springboot/èµ·æ­¥ä¾èµ–">èµ·æ­¥ä¾èµ–</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/springboot/è‡ªåŠ¨é…ç½®">è‡ªåŠ¨é…ç½®</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/springboot/ç³»ç»ŸæŒ‡æ ‡ç›‘æ§">ç³»ç»ŸæŒ‡æ ‡ç›‘æ§</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/springboot/spi">SPI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/springboot/springbootå¯åŠ¨">å¦‚ä½•å¯åŠ¨</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/springboot/å¸¸ç”¨æ³¨è§£">å¸¸ç”¨æ³¨è§£</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/springboot/åŸºæœ¬ç‰¹æ€§">åŸºæœ¬ç‰¹æ€§</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SpringCloud</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs.advanced.way/docs/zoology/spring-family/springcloud/feign">Feign</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">DispatcherServlet</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="dispatcherservlet"></a>DispatcherServlet<a class="hash-link" href="#dispatcherservlet" title="Direct link to heading">#</a></h2><p>å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="ç»“æ„å›¾"></a>ç»“æ„å›¾<a class="hash-link" href="#ç»“æ„å›¾" title="Direct link to heading">#</a></h3><p><img src="/docs.advanced.way/assets/images/DispatcherServlet-3f49e596b609b160e050aa2269c48745.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="åˆå§‹åŒ–"></a>åˆå§‹åŒ–<a class="hash-link" href="#åˆå§‹åŒ–" title="Direct link to heading">#</a></h2><p><img src="/docs.advanced.way/assets/images/2019021808191633-a3b6fa71fdcae3995568b916f793bf1a.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹<a class="hash-link" href="#å·¥ä½œæµç¨‹" title="Direct link to heading">#</a></h2><p><img src="/docs.advanced.way/assets/images/714509-20170920165202868-445512458-7305faf9a238e2246b0cb50629b65025.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="æµç¨‹è¯´æ˜"></a>æµç¨‹è¯´æ˜<a class="hash-link" href="#æµç¨‹è¯´æ˜" title="Direct link to heading">#</a></h3><ol><li><p>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€httpè¯·æ±‚,è¯·æ±‚è¢«å‰ç«¯æ§åˆ¶å™¨ <code>dispatcherServlet</code> æ•è·</p></li><li><p><code>dispatcherServlet</code> æ ¹æ®é…ç½®,å¯¹urlè¿›è¡Œè§£æ, åœ¨æ ¹æ®uriè°ƒç”¨ <code>HandlerMapping</code> è·å–è¯¥ <code>Handler</code> é…ç½®çš„æœ‰å…³å¯¹è±¡(åŒ…æ‹¬ <code>Handler</code> å¯¹è±¡ä»¥åŠ <code>Handler</code> å¯¹è±¡å¯¹åº”çš„æ‹¦æˆªå™¨), æœ€åä»¥ <code>HandlerExecutionChain</code> çš„å½¢å¼è¿”å›</p></li><li><p><code>dispatcherServlet</code> æ ¹æ®è·å¾—çš„ <code>Handler</code> ,é€‰æ‹©ä¸€ä¸ªåˆé€‚ <code>HandlerAdapter</code> (å¦‚æœè·å¾—æˆåŠŸ,å°±å°†æ‰§è¡Œæ‹¦æˆªå™¨å¯¹åº”çš„ <code>preHandler</code> æ–¹æ³•)</p></li><li><p>é€‚é…å™¨ <code>HandlerAdapter</code> å°† <code>Request</code> ä¸­çš„æ¨¡å‹æ•°æ®ä¼ å…¥ <code>Handler(Controller)</code></p></li><li><p><code>Handler(Controller)</code> æ‰§è¡Œç»“æŸå,è¿”å›ä¸€ä¸ª <code>ModelAndView</code> å¯¹è±¡</p></li><li><p>æ ¹æ®è¿”å›çš„ <code>ModelAndView</code> ,é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å·²ç»æ³¨å†Œåˆ° <code>Spring </code>å®¹å™¨çš„ <code>ViewResolver</code> ,è¿”å›ç»™ <code>dispatcherServlet</code></p></li><li><p><code>viewResolver</code> ç»“åˆ <code>Model</code> å’Œ <code>View</code> æ¸²æŸ“è§†å›¾</p></li><li><p><code>View</code> è§†å›¾è´Ÿè´£å°†æ¸²æŸ“ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯</p></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="å¦‚ä½•è¿›å…¥åˆ†å‘ä¸­å¿ƒ"></a>å¦‚ä½•è¿›å…¥åˆ†å‘ä¸­å¿ƒ<a class="hash-link" href="#å¦‚ä½•è¿›å…¥åˆ†å‘ä¸­å¿ƒ" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="httpservlet"></a>HttpServlet<a class="hash-link" href="#httpservlet" title="Direct link to heading">#</a></h4><p>è¯·æ±‚å…ˆåˆ°è¾¾ HttpServlet çš„serviceæ–¹æ³•ï¼Œserviceå†³å®šè°ƒç”¨å…·ä½“çš„doGetï¼ŒdoPostç­‰æ–¹æ³•</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">// HttpServlet æä¾›äº†å¯¹ Http åè®®çš„ Servlet å®ç°</span></div><div class="token-line" style="color:#393A34"><span class="token plain">// GenericServlet æä¾›äº†é»˜è®¤çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†</span></div><div class="token-line" style="color:#393A34"><span class="token plain">public abstract class HttpServlet extends GenericServlet {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    @Override</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    public void service(ServletRequest req, ServletResponse res)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        throws ServletException, IOException</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        HttpServletRequest  request;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        HttpServletResponse response;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (!(req instanceof HttpServletRequest &amp;&amp;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                res instanceof HttpServletResponse)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            throw new ServletException(&quot;non-HTTP request or response&quot;);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // å°† Servlet è½¬æ¢æˆ HttpServlet</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        request = (HttpServletRequest) req;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        response = (HttpServletResponse) res;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // è°ƒç”¨</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        service(request, response);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // service æ–¹æ³•</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    protected void service(HttpServletRequest req, HttpServletResponse resp)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        throws ServletException, IOException</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // è·å–è¯·æ±‚æ–¹æ³•</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        String method = req.getMethod();</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // åˆ¤æ–­æ–¹æ³•ç±»å‹</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (method.equals(METHOD_GET)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            long lastModified = getLastModified(req);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if (lastModified == -1) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // servlet doesn&#x27;t support if-modified-since, no reason</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // to go through further expensive logic</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                doGet(req, resp);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            } else {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                long ifModifiedSince = req.getDateHeader(HEADER_IFMODSINCE);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                if (ifModifiedSince &lt; lastModified) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    // If the servlet mod time is later, call doGet()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    // Round down to the nearest second for a proper compare</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    // A ifModifiedSince of -1 will always be less</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    maybeSetLastModified(resp, lastModified);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    doGet(req, resp);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                } else {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    resp.setStatus(HttpServletResponse.SC_NOT_MODIFIED);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        } else if (method.equals(METHOD_HEAD)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            long lastModified = getLastModified(req);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            maybeSetLastModified(resp, lastModified);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            doHead(req, resp);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        } else if (method.equals(METHOD_POST)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            doPost(req, resp);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        } else if (method.equals(METHOD_PUT)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            doPut(req, resp);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        } else if (method.equals(METHOD_DELETE)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            doDelete(req, resp);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        } else if (method.equals(METHOD_OPTIONS)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            doOptions(req,resp);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        } else if (method.equals(METHOD_TRACE)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            doTrace(req,resp);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        } else {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            //</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // Note that this means NO servlet supports whatever</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // method was requested, anywhere on this server.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            //</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            String errMsg = lStrings.getString(&quot;http.method_not_implemented&quot;);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Object[] errArgs = new Object[1];</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            errArgs[0] = method;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            errMsg = MessageFormat.format(errMsg, errArgs);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span></div><div class="token-line" style="color:#393A34"><span class="token plain">            resp.sendError(HttpServletResponse.SC_NOT_IMPLEMENTED, errMsg);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="frameworkservlet"></a>FrameworkServlet<a class="hash-link" href="#frameworkservlet" title="Direct link to heading">#</a></h4><ol><li><p>FrameworkServlet é‡å†™äº† HttpServletçš„doGetç­‰æ–¹æ³•ï¼Œäºæ˜¯å°±ä¼šè°ƒç”¨FrameworkServletçš„doGetç­‰æ–¹æ³•</p></li><li><p>åœ¨doGetç­‰æ–¹æ³•ä¸­éƒ½ä¼šè°ƒç”¨ processRequest(request, response)æ–¹æ³•</p></li><li><p>è°ƒç”¨doService(request, response). ç”±äºdoServiceåœ¨FrameworkServletä¸­ä¸ºæŠ½è±¡æ–¹æ³•ï¼Œæ‰€ä»¥è°ƒç”¨DispatcherServleté‡å†™çš„doServiceæ–¹æ³•</p></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">public abstract class FrameworkServlet extends HttpServletBean implements ApplicationContextAware {</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    @Override</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    protected final void doGet(HttpServletRequest request, HttpServletResponse response)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            throws ServletException, IOException {</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        processRequest(request, response);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    protected final void processRequest(HttpServletRequest request, HttpServletResponse response)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            throws ServletException, IOException {</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        long startTime = System.currentTimeMillis();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        Throwable failureCause = null;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        LocaleContext previousLocaleContext = LocaleContextHolder.getLocaleContext();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        LocaleContext localeContext = buildLocaleContext(request);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        RequestAttributes previousAttributes = RequestContextHolder.getRequestAttributes();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        ServletRequestAttributes requestAttributes = buildRequestAttributes(request, response, previousAttributes);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        asyncManager.registerCallableInterceptor(FrameworkServlet.class.getName(), new RequestBindingInterceptor());</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        initContextHolders(request, localeContext, requestAttributes);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        try {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // æŠ½è±¡æ–¹æ³•ï¼Œè°ƒç”¨ DispatcherServlet é‡å†™çš„ doServiceæ–¹æ³•</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            doService(request, response);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        catch (ServletException | IOException ex) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            failureCause = ex;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            throw ex;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        catch (Throwable ex) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            failureCause = ex;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            throw new NestedServletException(&quot;Request processing failed&quot;, ex);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        finally {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            resetContextHolders(request, previousLocaleContext, previousAttributes);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if (requestAttributes != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                requestAttributes.requestCompleted();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            logResult(request, response, failureCause, asyncManager);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            publishRequestHandledEvent(request, response, startTime, failureCause);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="dispatcherservlet-1"></a>DispatcherServlet<a class="hash-link" href="#dispatcherservlet-1" title="Direct link to heading">#</a></h4><p>è°ƒç”¨ doDispatch(request, response)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">public class DispatcherServlet extends FrameworkServlet {</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    @Override</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    protected void doService(HttpServletRequest request, HttpServletResponse response) throws Exception {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        logRequest(request);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // Keep a snapshot of the request attributes in case of an include,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // to be able to restore the original attributes after the include.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, Object&gt; attributesSnapshot = null;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (WebUtils.isIncludeRequest(request)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            attributesSnapshot = new HashMap&lt;&gt;();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Enumeration&lt;?&gt; attrNames = request.getAttributeNames();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            while (attrNames.hasMoreElements()) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                String attrName = (String) attrNames.nextElement();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                if (this.cleanupAfterInclude || attrName.startsWith(DEFAULT_STRATEGIES_PREFIX)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    attributesSnapshot.put(attrName, request.getAttribute(attrName));</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // Make framework objects available to handlers and view objects.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext());</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, this.localeResolver);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        request.setAttribute(THEME_RESOLVER_ATTRIBUTE, this.themeResolver);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        request.setAttribute(THEME_SOURCE_ATTRIBUTE, getThemeSource());</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (this.flashMapManager != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            FlashMap inputFlashMap = this.flashMapManager.retrieveAndUpdate(request, response);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if (inputFlashMap != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap));</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, new FlashMap());</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, this.flashMapManager);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        try {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            doDispatch(request, response);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        finally {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if (!WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // Restore the original attribute snapshot, in case of an include.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                if (attributesSnapshot != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    restoreAttributesAfterInclude(request, attributesSnapshot);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // è¯·æ±‚åˆ†å‘ä¸­å¿ƒ</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // å®šä¹‰ä¸€ä¸ªå·²å¤„ç†è¯·æ±‚ï¼ŒæŒ‡å‘ request</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        HttpServletRequest processedRequest = request;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // å®šä¹‰å¤„ç†å™¨æ‰§è¡Œé“¾ å†…éƒ¨å°è£…æ‹¦æˆªå™¨åˆ—è¡¨å’Œå¤„ç†å™¨</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        HandlerExecutionChain mappedHandler = null;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        boolean multipartRequestParsed = false;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // è·å–å’Œå½“å‰è¯·æ±‚ç›¸å…³çš„å¼‚æ­¥ç®¡ç†å™¨</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        try {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            ModelAndView mv = null;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Exception dispatchException = null;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            try {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // åˆ¤æ–­æ˜¯å¦æœ‰æ–‡ä»¶ä¸Šä¼ ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„è¯·æ±‚</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                processedRequest = checkMultipart(request);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                multipartRequestParsed = (processedRequest != request);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // getHandler ä¸­éå† HandlerMappingï¼Œè·å–å¯¹åº”çš„ HandlerExecutionChain</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // HandlerExecutionChainï¼ŒåŒ…å« HandlerInterceptor å’ŒHandlerMethod</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // Determine handler for the current request.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                mappedHandler = getHandler(processedRequest);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                if (mappedHandler == null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    // not found</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    noHandlerFound(processedRequest, response);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    return;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // è·å–æ”¯æŒè¯¥å¤„ç†å™¨çš„å¤„ç†é€‚é…å™¨</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // åˆ¤æ–­è¯·æ±‚å†…å®¹æ˜¯å¦éœ€è¦ä¿®æ”¹ï¼Œå¦‚æœæœªä¿®æ”¹ç›´æ¥è¿”å›ï¼Œæµè§ˆå™¨ä½¿ç”¨æœ¬åœ°ç¼“å­˜</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                String method = request.getMethod();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                boolean isGet = &quot;GET&quot;.equals(method);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                if (isGet || &quot;HEAD&quot;.equals(method)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    long lastModified = ha.getLastModified(request, mappedHandler.getHandler());</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    if (new ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        return;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // å¦‚æœæœ‰æ‹¦æˆªå™¨çš„è¯ï¼Œä¼šæ‰§è¡Œæ‹¦æˆªå™¨çš„ preHandler æ–¹æ³•</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                if (!mappedHandler.applyPreHandle(processedRequest, response)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    // æ‹¦æˆªå™¨ç”Ÿæ•ˆ è¿”å›</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    return;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œä¼ å…¥è¯·æ±‚ã€å“åº”ã€å¯¹åº”çš„å¤„ç†å™¨</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // åˆ¤æ–­æ˜¯å¦æ˜¯å¼‚æ­¥è¯·æ±‚ï¼Œåç»­æ“ä½œå‡é€šè¿‡å¼‚æ­¥å¤„ç†</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                if (asyncManager.isConcurrentHandlingStarted()) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    return;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // å½“viewä¸ºç©ºæ—¶ï¼Œæ ¹æ®requestè®¾ç½®é»˜è®¤view</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                applyDefaultViewName(processedRequest, mv);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // æ‰§è¡Œæ‹¦æˆªå™¨çš„ postHandle</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                mappedHandler.applyPostHandle(processedRequest, response, mv);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            catch (Exception ex) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // å‘é€å¼‚å¸¸ ä¿å­˜åˆ° dispatchException</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                dispatchException = ex;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            catch (Throwable err) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // As of 4.3, we&#x27;re processing Errors thrown from handler methods as well,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // making them available for @ExceptionHandler methods and other scenarios.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                dispatchException = new NestedServletException(&quot;Handler dispatch failed&quot;, err);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // å¯¹æ‰§è¡Œç»“æœè¿›è¡Œå¤„ç†ï¼ŒåŒ…æ‹¬å¤„ç†é€‚é…å™¨çš„ç»“æœå’Œå‘é€çš„å¼‚å¸¸</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        catch (Exception ex) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            triggerAfterCompletion(processedRequest, response, mappedHandler, ex);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        catch (Throwable err) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            triggerAfterCompletion(processedRequest, response, mappedHandler,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    new NestedServletException(&quot;Handler processing failed&quot;, err));</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        finally {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // åˆ¤æ–­æ˜¯å¦æ˜¯å¼‚æ­¥è¯·æ±‚</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if (asyncManager.isConcurrentHandlingStarted()) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // Instead of postHandle and afterCompletion</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                if (mappedHandler != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            else {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // åˆ é™¤ä¸Šä¼ èµ„æº</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // Clean up any resources used by a multipart request.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                if (multipartRequestParsed) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    cleanupMultipart(processedRequest);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="è¯·æ±‚åˆ†å‘è¯¦è§£"></a>è¯·æ±‚åˆ†å‘è¯¦è§£<a class="hash-link" href="#è¯·æ±‚åˆ†å‘è¯¦è§£" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="æ–‡ä»¶ä¸Šä¼ è¯·æ±‚"></a>æ–‡ä»¶ä¸Šä¼ è¯·æ±‚<a class="hash-link" href="#æ–‡ä»¶ä¸Šä¼ è¯·æ±‚" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">protected HttpServletRequest checkMultipart(HttpServletRequest request) throws MultipartException {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // åˆ¤æ–­æ˜¯å¦ä¸ºå¤šå—è¯·æ±‚</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if (this.multipartResolver != null &amp;&amp; this.multipartResolver.isMultipart(request)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (WebUtils.getNativeRequest(request, MultipartHttpServletRequest.class) != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if (request.getDispatcherType().equals(DispatcherType.REQUEST)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                logger.trace(&quot;Request already resolved to MultipartHttpServletRequest, e.g. by MultipartFilter&quot;);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // åŒ…å«å¼‚å¸¸</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        else if (hasMultipartException(request)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            logger.debug(&quot;Multipart resolution previously failed for current request - &quot; +</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;skipping re-resolution for undisturbed error rendering&quot;);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        else {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            try {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // ä½¿ç”¨å¤šå—è§£æå™¨è§£æå¤šå—è¯·æ±‚ï¼Œå¹¶è¿”å›å¤šå—è¯·æ±‚è§£æå™¨åŒ…è£…è¿‡çš„å¤šå—è¯·æ±‚</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                return this.multipartResolver.resolveMultipart(request);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            catch (MultipartException ex) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                if (request.getAttribute(WebUtils.ERROR_EXCEPTION_ATTRIBUTE) != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    logger.debug(&quot;Multipart resolution failed for error dispatch&quot;, ex);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    // Keep processing error dispatch with regular request handle below</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                else {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    throw ex;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // If not returned before: return original request.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return request;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="æŸ¥æ‰¾è¯·æ±‚å¤„ç†å™¨"></a>æŸ¥æ‰¾è¯·æ±‚å¤„ç†å™¨<a class="hash-link" href="#æŸ¥æ‰¾è¯·æ±‚å¤„ç†å™¨" title="Direct link to heading">#</a></h3><p>Spring mvc å°†è¯·æ±‚å¤„ç†çš„æŸ¥æ‰¾å’Œæ‰§è¡Œåˆ†ç¦»å¼€</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">@Nullable</span></div><div class="token-line" style="color:#393A34"><span class="token plain">protected HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if (this.handlerMappings != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // éå†å…¨éƒ¨çš„å¤„ç†å™¨æ˜ å°„</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        for (HandlerMapping mapping : this.handlerMappings) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // è·å–ä¸æœ¬æ¬¡è¯·æ±‚é€‚é…çš„å¤„ç†å™¨é“¾</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            HandlerExecutionChain handler = mapping.getHandler(request);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // è¿”å›ï¼Œæœ‰å¤šä¸ªå¤„ç†å™¨é“¾åªè¿”å›ç¬¬ä¸€ä¸ª</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if (handler != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                return handler;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return null;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="è·å–å¤„ç†é€‚é…å™¨"></a>è·å–å¤„ç†é€‚é…å™¨<a class="hash-link" href="#è·å–å¤„ç†é€‚é…å™¨" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">protected HandlerAdapter getHandlerAdapter(Object handler) throws ServletException {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if (this.handlerAdapters != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // éå†å¤„ç†é€‚é…å™¨åˆ—è¡¨ï¼Œè°ƒç”¨supportsæ–¹æ³•ï¼Œæ‰¾åˆ°æ”¯æŒæ”¹å¤„ç†å™¨çš„é€‚é…å™¨</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        for (HandlerAdapter adapter : this.handlerAdapters) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // æ‰¾åˆ°åè¿”å›</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if (adapter.supports(handler)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                return adapter;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    throw new ServletException(&quot;No adapter for handler [&quot; + handler +</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&quot;);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="å¤„ç†httpç¼“å­˜"></a>å¤„ç†Httpç¼“å­˜<a class="hash-link" href="#å¤„ç†httpç¼“å­˜" title="Direct link to heading">#</a></h3><p>ä¸ºäº†æé«˜ Http è¯·æ±‚æ•ˆç‡ï¼Œå…è®¸æµè§ˆå™¨å¯¹Get è¯·æ±‚çš„è·å–åˆ°çš„èµ„æºè¿›è¡Œç¼“å­˜</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">// åˆ¤æ–­è¯·æ±‚å†…å®¹æ˜¯å¦éœ€è¦ä¿®æ”¹ï¼Œå¦‚æœæœªä¿®æ”¹ç›´æ¥è¿”å›ï¼Œæµè§ˆå™¨ä½¿ç”¨æœ¬åœ°ç¼“å­˜</span></div><div class="token-line" style="color:#393A34"><span class="token plain">String method = request.getMethod();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">boolean isGet = &quot;GET&quot;.equals(method);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">// åªæ”¯æŒ &quot;get head&quot; è¯·æ±‚</span></div><div class="token-line" style="color:#393A34"><span class="token plain">if (isGet || &quot;HEAD&quot;.equals(method)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // è·å–æœ€åä¸€æ¬¡ä¿®æ”¹çš„æ—¶é—´</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    long lastModified = ha.getLastModified(request, mappedHandler.getHandler());</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // æ£€æŸ¥å½“å‰è¯·æ±‚ä¸­æºå¸¦çš„ç¼“å­˜ä¿¡æ¯æ˜¯å¦è¿‡æœŸ</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if (new ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        return;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="æ‰§è¡Œå‰ç½®æ‹¦æˆªå™¨é“¾"></a>æ‰§è¡Œå‰ç½®æ‹¦æˆªå™¨é“¾<a class="hash-link" href="#æ‰§è¡Œå‰ç½®æ‹¦æˆªå™¨é“¾" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">public class HandlerExecutionChain {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    boolean applyPreHandle(HttpServletRequest request, HttpServletResponse response) throws Exception {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // è·å–å½“å‰å¤„ç†å™¨æ‰§è¡Œé“¾çš„æ‰€æœ‰æ‹¦æˆªå™¨</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        HandlerInterceptor[] interceptors = getInterceptors();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (!ObjectUtils.isEmpty(interceptors)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // éå†æ‹¦æˆªå™¨</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 0; i &lt; interceptors.length; i++) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                HandlerInterceptor interceptor = interceptors[i];</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // æ‰§è¡Œæ‹¦æˆªå™¨çš„preHandleæ–¹æ³•</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // è¿”å› false,åœæ­¢æ‰§è¡Œ</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                if (!interceptor.preHandle(request, response, this.handler)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    triggerAfterCompletion(request, response, null);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    return false;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // è¿”å› trueï¼Œ æ‹¦æˆªå™¨ç´¢å¼•è®¾ä¸ºå½“å‰éå†ç´¢å¼•</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                this.interceptorIndex = i;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // æ‰§è¡Œå®Œæ¯•</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        return true;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="å¤„ç†é€‚é…å™¨æ‰§è¡Œ"></a>å¤„ç†é€‚é…å™¨æ‰§è¡Œ<a class="hash-link" href="#å¤„ç†é€‚é…å™¨æ‰§è¡Œ" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">// å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œä¼ å…¥è¯·æ±‚ã€å“åº”ã€å¯¹åº”çš„å¤„ç†å™¨</span></div><div class="token-line" style="color:#393A34"><span class="token plain">mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="è¿”å›å€¼è§†å›¾åå¤„ç†"></a>è¿”å›å€¼è§†å›¾åå¤„ç†<a class="hash-link" href="#è¿”å›å€¼è§†å›¾åå¤„ç†" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">private void applyDefaultViewName(HttpServletRequest request, @Nullable ModelAndView mv) throws Exception {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // mv ä¸ä¸ºç©º ä¸”ä¸åŒ…å«è§†å›¾</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if (mv != null &amp;&amp; !mv.hasView()) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // è·å–é»˜è®¤çš„è§†å›¾å</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        String defaultViewName = getDefaultViewName(request);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (defaultViewName != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // é»˜è®¤çš„è§†å›¾åä¸ä¸ºç©ºï¼Œåˆ™å°†å…¶è®¾ç½®ä¸º ModelAndView çš„è§†å›¾å</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            mv.setViewName(defaultViewName);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">@Nullable</span></div><div class="token-line" style="color:#393A34"><span class="token plain">protected String getDefaultViewName(HttpServletRequest request) throws Exception {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return (this.viewNameTranslator != null ? this.viewNameTranslator.getViewName(request) : null);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="æ‰§è¡Œåç½®æ‹¦æˆªå™¨é“¾"></a>æ‰§è¡Œåç½®æ‹¦æˆªå™¨é“¾<a class="hash-link" href="#æ‰§è¡Œåç½®æ‹¦æˆªå™¨é“¾" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">public class HandlerExecutionChain {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    void applyPostHandle(HttpServletRequest request, HttpServletResponse response, @Nullable ModelAndView mv)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            throws Exception {</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        HandlerInterceptor[] interceptors = getInterceptors();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (!ObjectUtils.isEmpty(interceptors)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            for (int i = interceptors.length - 1; i &gt;= 0; i--) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                HandlerInterceptor interceptor = interceptors[i];</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                // æ‰§è¡Œï¼Œæ— è¿”å›å€¼</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                interceptor.postHandle(request, response, this.handler, mv);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="å¤„ç†è¿”å›å€¼å’Œå“åº”"></a>å¤„ç†è¿”å›å€¼å’Œå“åº”<a class="hash-link" href="#å¤„ç†è¿”å›å€¼å’Œå“åº”" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">private void processDispatchResult(HttpServletRequest request, HttpServletResponse response,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        @Nullable HandlerExecutionChain mappedHandler, @Nullable ModelAndView mv,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        @Nullable Exception exception) throws Exception {</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // æ ‡è®°æ˜¯å¦æ˜¯ error è§†å›¾</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    boolean errorView = false;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // å‘ç”Ÿå¼‚å¸¸</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if (exception != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (exception instanceof ModelAndViewDefiningException) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            logger.debug(&quot;ModelAndViewDefiningException encountered&quot;, exception);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            mv = ((ModelAndViewDefiningException) exception).getModelAndView();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        else {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // è·å–å¤„ç†å™¨</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            Object handler = (mappedHandler != null ? mappedHandler.getHandler() : null);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // æ‰§è¡Œprocesså¤„ç†å™¨çš„å¼‚å¸¸æ–¹æ³•ï¼Œè·å–å¤„ç†äº†å¼‚å¸¸ç»“æœåå¾—åˆ°çš„ModelAndViewç»“æœ</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            mv = processHandlerException(request, response, handler, exception);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // è¿”å›å¼‚å¸¸è§†å›¾</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            errorView = (mv != null);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // Did the handler return a view to render?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // è§†å›¾å’Œæ¨¡å‹ä¸ä¸ºç©ºï¼Œä¸”è§†å›¾ä¸æ¨¡å‹æ²¡å“Ÿæ ‡è®°ä¸ºè¢«æ¸…ç†</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if (mv != null &amp;&amp; !mv.wasCleared()) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // æ‰§è¡Œæ¸²æŸ“è§†å›¾çš„æ“ä½œ</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        render(mv, request, response);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // å¦‚æœæ˜¯å¼‚å¸¸è§†å›¾ï¼Œæ¸²æŸ“åéœ€è¦æ¸…ç†è¯·æ±‚å±æ€§çš„å¼‚å¸¸ä¿¡æ¯</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (errorView) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            WebUtils.clearErrorRequestAttributes(request);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    else {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // è§†å›¾ä¸ºç©ºï¼Œæ‰“å°æ—¥å¿—</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (logger.isTraceEnabled()) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            logger.trace(&quot;No view rendering, null ModelAndView returned.&quot;);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // å¦‚æœå¼‚æ­¥å¤„ç†å·²ç»å¼€å§‹ï¼Œåˆ™ç›´æ¥è¿”å›ç»“æŸæ‰§è¡Œ</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // Concurrent handling started during a forward</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        return;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // è§¦å‘æ‹¦æˆªå™¨é“¾çš„å®Œæˆåæ–¹æ³•</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if (mappedHandler != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // Exception (if any) is already handled..</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        mappedHandler.triggerAfterCompletion(request, response, null);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="æ‰§è¡Œå®Œæˆæ‹¦æˆªå™¨é“¾"></a>æ‰§è¡Œå®Œæˆæ‹¦æˆªå™¨é“¾<a class="hash-link" href="#æ‰§è¡Œå®Œæˆæ‹¦æˆªå™¨é“¾" title="Direct link to heading">#</a></h3><p>åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­æ— è®ºæ˜¯ preHandle æå‰è¿”å› false,è¿˜æ˜¯å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œæˆ–æ˜¯æ­£å¸¸å¤„ç†å®Œæˆï¼Œéƒ½ä¼šè°ƒç”¨æ‹¦æˆªå™¨é“¾çš„è¯¥æ–¹æ³•</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">public class HandlerExecutionChain {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    void triggerAfterCompletion(HttpServletRequest request, HttpServletResponse response, @Nullable Exception ex)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            throws Exception {</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        HandlerInterceptor[] interceptors = getInterceptors();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (!ObjectUtils.isEmpty(interceptors)) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // ä»¥ interceptorIndex ç´¢å¼•å¼€å§‹å€’åºéå†</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            for (int i = this.interceptorIndex; i &gt;= 0; i--) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                HandlerInterceptor interceptor = interceptors[i];</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                try {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    // æ‰§è¡Œæ‹¦æˆªå™¨çš„ afterCompletion æ–¹æ³•</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    interceptor.afterCompletion(request, response, this.handler, ex);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                catch (Throwable ex2) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    logger.error(&quot;HandlerInterceptor.afterCompletion threw exception&quot;, ex2);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="æ¸…ç†èµ„æº"></a>æ¸…ç†èµ„æº<a class="hash-link" href="#æ¸…ç†èµ„æº" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">protected void cleanupMultipart(HttpServletRequest request) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if (this.multipartResolver != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        MultipartHttpServletRequest multipartRequest =</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                WebUtils.getNativeRequest(request, MultipartHttpServletRequest.class);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (multipartRequest != null) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // æ¸…ç†</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            this.multipartResolver.cleanupMultipart(multipartRequest);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Goldwood1024/docs.advanced.way/tree/master/docs/zoology/spring-family/springmvc/DispatcherServlet.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-06-03T08:37:42.000Z" class="lastUpdatedDate_1WI_">6/3/2021</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs.advanced.way/docs/zoology/spring-family/springmvc/Session"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Session</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs.advanced.way/docs/zoology/spring-family/springmvc/RequestMapping"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">@RequestMapping Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#dispatcherservlet" class="table-of-contents__link">DispatcherServlet</a><ul><li><a href="#ç»“æ„å›¾" class="table-of-contents__link">ç»“æ„å›¾</a></li></ul></li><li><a href="#åˆå§‹åŒ–" class="table-of-contents__link">åˆå§‹åŒ–</a></li><li><a href="#å·¥ä½œæµç¨‹" class="table-of-contents__link">å·¥ä½œæµç¨‹</a><ul><li><a href="#æµç¨‹è¯´æ˜" class="table-of-contents__link">æµç¨‹è¯´æ˜</a></li><li><a href="#å¦‚ä½•è¿›å…¥åˆ†å‘ä¸­å¿ƒ" class="table-of-contents__link">å¦‚ä½•è¿›å…¥åˆ†å‘ä¸­å¿ƒ</a></li></ul></li><li><a href="#è¯·æ±‚åˆ†å‘è¯¦è§£" class="table-of-contents__link">è¯·æ±‚åˆ†å‘è¯¦è§£</a><ul><li><a href="#æ–‡ä»¶ä¸Šä¼ è¯·æ±‚" class="table-of-contents__link">æ–‡ä»¶ä¸Šä¼ è¯·æ±‚</a></li><li><a href="#æŸ¥æ‰¾è¯·æ±‚å¤„ç†å™¨" class="table-of-contents__link">æŸ¥æ‰¾è¯·æ±‚å¤„ç†å™¨</a></li><li><a href="#è·å–å¤„ç†é€‚é…å™¨" class="table-of-contents__link">è·å–å¤„ç†é€‚é…å™¨</a></li><li><a href="#å¤„ç†httpç¼“å­˜" class="table-of-contents__link">å¤„ç†Httpç¼“å­˜</a></li><li><a href="#æ‰§è¡Œå‰ç½®æ‹¦æˆªå™¨é“¾" class="table-of-contents__link">æ‰§è¡Œå‰ç½®æ‹¦æˆªå™¨é“¾</a></li><li><a href="#å¤„ç†é€‚é…å™¨æ‰§è¡Œ" class="table-of-contents__link">å¤„ç†é€‚é…å™¨æ‰§è¡Œ</a></li><li><a href="#è¿”å›å€¼è§†å›¾åå¤„ç†" class="table-of-contents__link">è¿”å›å€¼è§†å›¾åå¤„ç†</a></li><li><a href="#æ‰§è¡Œåç½®æ‹¦æˆªå™¨é“¾" class="table-of-contents__link">æ‰§è¡Œåç½®æ‹¦æˆªå™¨é“¾</a></li><li><a href="#å¤„ç†è¿”å›å€¼å’Œå“åº”" class="table-of-contents__link">å¤„ç†è¿”å›å€¼å’Œå“åº”</a></li><li><a href="#æ‰§è¡Œå®Œæˆæ‹¦æˆªå™¨é“¾" class="table-of-contents__link">æ‰§è¡Œå®Œæˆæ‹¦æˆªå™¨é“¾</a></li><li><a href="#æ¸…ç†èµ„æº" class="table-of-contents__link">æ¸…ç†èµ„æº</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 è¿›é˜¶ä¹‹è·¯, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docs.advanced.way/assets/js/runtime~main.871cb501.js"></script>
<script src="/docs.advanced.way/assets/js/main.9348fd2a.js"></script>
</body>
</html>