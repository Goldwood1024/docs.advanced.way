<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link rel="alternate" type="application/rss+xml" href="/docs.advanced.way/blog/rss.xml" title="进阶之路 Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs.advanced.way/blog/atom.xml" title="进阶之路 Blog Atom Feed"><title data-react-helmet="true">Posts tagged &quot;cache&quot; | 进阶之路</title><meta data-react-helmet="true" property="og:title" content="Posts tagged &quot;cache&quot; | 进阶之路"><meta data-react-helmet="true" name="description" content="Blog | Tagged &quot;cache&quot;"><meta data-react-helmet="true" property="og:description" content="Blog | Tagged &quot;cache&quot;"><meta data-react-helmet="true" property="og:url" content="https://Goldwood1024.github.io/docs.advanced.way/blog/tags/cache"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="shortcut icon" href="/docs.advanced.way/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://Goldwood1024.github.io/docs.advanced.way/blog/tags/cache"><link data-react-helmet="true" rel="alternate" href="https://Goldwood1024.github.io/docs.advanced.way/blog/tags/cache" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://Goldwood1024.github.io/docs.advanced.way/blog/tags/cache" hreflang="x-default"><link rel="stylesheet" href="/docs.advanced.way/assets/css/styles.5e159b62.css">
<link rel="preload" href="/docs.advanced.way/assets/js/runtime~main.aa1c8b94.js" as="script">
<link rel="preload" href="/docs.advanced.way/assets/js/main.8fae9188.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs.advanced.way/"><img src="/docs.advanced.way/img/logo.svg" alt="进阶之路 Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/docs.advanced.way/img/logo.svg" alt="进阶之路 Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">进阶之路</strong></a><a class="navbar__item navbar__link" href="/docs.advanced.way/docs/java/">Java</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">生态</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs.advanced.way/docs/zoology/spring-family/">Spring家族</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/zoology/framework/mybatis/">常用框架</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/zoology/distributed/">分布式</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/zoology/cloud/docker/base/镜像/">容器</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/zoology/db/mysql/InnoDB/">数据库</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/zoology/os/network/tcpip/">计算机系统</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">编码实践</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs.advanced.way/docs/algorithm/algorithm/">算法/数据结构</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/patterns/">设计模式</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/architecture/">系统架构</a></li><li><a class="dropdown__link" href="/docs.advanced.way/docs/practice/memo/tool/sublime/">备忘录</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs.advanced.way/blog">博客</a><a href="https://github.com/Goldwood1024/docs.advanced.way.git" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docs.advanced.way/"><img src="/docs.advanced.way/img/logo.svg" alt="进阶之路 Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/docs.advanced.way/img/logo.svg" alt="进阶之路 Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">进阶之路</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/java/">Java</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">生态</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/zoology/spring-family/">Spring家族</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/zoology/framework/mybatis/">常用框架</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/zoology/distributed/">分布式</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/zoology/cloud/docker/base/镜像/">容器</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/zoology/db/mysql/InnoDB/">数据库</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/zoology/os/network/tcpip/">计算机系统</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">编码实践</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/algorithm/algorithm/">算法/数据结构</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/patterns/">设计模式</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/architecture/">系统架构</a></li><li class="menu__list-item"><a class="menu__link" href="/docs.advanced.way/docs/practice/memo/tool/sublime/">备忘录</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs.advanced.way/blog">博客</a></li><li class="menu__list-item"><a href="https://github.com/Goldwood1024/docs.advanced.way.git" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/err">错误信息</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/validation">参数检验</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/smartmontools">硬盘检测</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/Distributed-consensus-algorithm">分布式共识算法</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/cache-pattern">缓存模型</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/mysql-log">Mysql 日志文件</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/Hash-Flooding">哈希洪水攻击</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/hash">Hash算法</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/redis.ae">redis 事件模型</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/transaction">事务</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/unique-id">唯一ID生成规则</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/mysql-state">mysql 进程常见的 State</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/mysql">mysql 常用片段</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/recover-macoos">macOS 恢复</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/docs.advanced.way/blog/vuepess-upgrade-docusaurus">Vuepress 升级到 Docusaurus</a></li></ul></div></div><main class="col col--7"><h1>One post tagged with &quot;cache&quot;</h1><a href="/docs.advanced.way/blog/tags">View All Tags</a><div class="margin-vert--xl"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/docs.advanced.way/blog/cache-pattern">缓存模型</a></h2><div class="margin-vert--md"><time datetime="2021-06-03T00:00:00.000Z" class="blogPostDate_fNvV">June 3, 2021 · One min read</time></div><div class="avatar margin-vert--md"><div class="avatar__intro"></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="缓存模型"></a>缓存模型<a class="hash-link" href="#缓存模型" title="Direct link to heading">#</a></h2><p>缓存可以提升性能、缓解数据库压力，但是使用缓存也会导致数据不一致性的问题。</p><p>经典的缓存使用模式: </p><ul><li>Cache-Aside Pattern</li><li>Read-Through/Write-through</li><li>Write-behind</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="cache-aside-pattern"></a>Cache-Aside Pattern<a class="hash-link" href="#cache-aside-pattern" title="Direct link to heading">#</a></h3><p>旁路缓存模式，它的提出是为了尽可能地解决缓存与数据库的数据不一致问题</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="读流程"></a>读流程<a class="hash-link" href="#读流程" title="Direct link to heading">#</a></h4><p><img src="/docs.advanced.way/assets/images/b93293bab20f7503950b730594703a53-a8ba3b9f2ff7d19f1baa42ad8abbba49.jpg"></p><ol><li>先读缓存，缓存命中，直接返回数据</li><li>缓存没有命中，读数据库</li><li>从数据库取出数据，放入缓存后</li><li>返回响应</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="写流程"></a>写流程<a class="hash-link" href="#写流程" title="Direct link to heading">#</a></h4><p><strong>先更新数据库，然后再删除缓存</strong></p><blockquote><p>防止并发场景，数据不一致</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="read-throughwrite-through"></a>Read-Through/Write-Through<a class="hash-link" href="#read-throughwrite-through" title="Direct link to heading">#</a></h3><p>Read/Write-Through(读写穿透) 模式中，服务端把缓存作为主要数据存储。
应用程序跟数据库缓存交互，都是通过抽象缓存层完成</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="读流程-1"></a>读流程<a class="hash-link" href="#读流程-1" title="Direct link to heading">#</a></h4><p><img src="/docs.advanced.way/assets/images/7b8ca8721e5f7da70376875f14e96cfb-c69626b4aa5a96d8352f3f64dc90504e.jpg"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="写流程-1"></a>写流程<a class="hash-link" href="#写流程-1" title="Direct link to heading">#</a></h4><p><img src="/docs.advanced.way/assets/images/504b11c77f6a8609f09f23fac659c4da-4c6b4207c8f1ea103d34523eba5c1c4f.jpg"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="write-behind"></a>Write-behind<a class="hash-link" href="#write-behind" title="Direct link to heading">#</a></h3><p>Write-Behind则是只更新缓存，不直接更新数据库，通过<strong>批量异步</strong>的方式来更新数据库</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="流程"></a>流程<a class="hash-link" href="#流程" title="Direct link to heading">#</a></h4><p><img src="/docs.advanced.way/assets/images/fb33e93d464712d06b8b7c1b5b771ba8-e8d9bd399268f6802ab99a1398353ba1.jpg"></p><p>这种方式下，缓存和数据库的一致性不强，对一致性要求高的系统要谨慎使用</p><blockquote><p>适合频繁写的场景，<code>MySQL</code> 的 <code>InnoDB Buffer Pool</code> 机制就使用到这种模式</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="场景1-操作缓存的时候，到底是删除缓存呢，还是更新缓存"></a>场景1 操作缓存的时候，到底是删除缓存呢，还是更新缓存<a class="hash-link" href="#场景1-操作缓存的时候，到底是删除缓存呢，还是更新缓存" title="Direct link to heading">#</a></h3><p><img src="/docs.advanced.way/assets/images/69fe5712c096ade14e2e3b9b1270fcf2-aa0fc527f769db362445a6efa2192a51.jpg"></p><ol><li>线程A先发起一个写操作，第一步先更新数据库</li><li>线程B再发起一个写操作，第二步更新了数据库</li><li>由于网络等原因，线程B先更新了缓存</li><li>线程A更新缓存</li></ol><p>这时候，缓存保存的是A的数据（老数据），数据库保存的是B的数据（新数据），数据不一致了，脏数据出现啦。</p><p>如果是删除缓存取代更新缓存则不会出现这个脏数据问题</p><blockquote><p>更新缓存相对于删除缓存，还有两点劣势:</p><ul><li>如果你写入的缓存值，是经过复杂计算才得到的话。更新缓存频率高的话，就浪费性能啦。</li><li>在写数据库场景多，读数据场景少的情况下，数据很多时候还没被读取到，又被更新了，这也浪费了性能呢(实际上，写多的场景，用缓存也不是很划算的,哈哈)</li></ul></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="场景2-双写的情况下，先操作数据库还是先操作缓存？"></a>场景2 双写的情况下，先操作数据库还是先操作缓存？<a class="hash-link" href="#场景2-双写的情况下，先操作数据库还是先操作缓存？" title="Direct link to heading">#</a></h3><p>先操作数据库</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="场景3-删除缓存失败如何处理"></a>场景3 删除缓存失败如何处理<a class="hash-link" href="#场景3-删除缓存失败如何处理" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="缓存延时双删"></a>缓存延时双删<a class="hash-link" href="#缓存延时双删" title="Direct link to heading">#</a></h4><ol><li>先删除缓存</li><li>更新数据库</li><li>休眠一会，在删除缓存</li></ol><blockquote><p>休眠时间 = 读业务逻辑数据的耗时 + 几百毫秒</p></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="删除缓存重试机制"></a>删除缓存重试机制<a class="hash-link" href="#删除缓存重试机制" title="Direct link to heading">#</a></h4><ul><li>写请求更新数据库</li><li>缓存因为某些原因，删除失败</li><li>把删除失败的key放到MQ</li><li>消费MQ的消息，获取要删除的key</li><li>重试删除缓存操作</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="读取biglog异步删除缓存"></a>读取biglog异步删除缓存<a class="hash-link" href="#读取biglog异步删除缓存" title="Direct link to heading">#</a></h4><p><img src="/docs.advanced.way/assets/images/9fe12b61c540cd6435a45d1603e5f727-aca5ad084c0ea16634631351aa754524.jpg"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="相关文档"></a>相关文档<a class="hash-link" href="#相关文档" title="Direct link to heading">#</a></h2><ul><li><a href="https://mp.weixin.qq.com/s/ZTCbrR65Xyr23xAp36_wcw" target="_blank" rel="noopener noreferrer">Redis与MySQL双写一致性如何保证</a></li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/docs.advanced.way/blog/tags/缓存模型">缓存模型</a><a class="margin-horiz--sm" href="/docs.advanced.way/blog/tags/cache">cache</a></div><div class="col text--right"><a aria-label="Read more about 缓存模型" href="/docs.advanced.way/blog/cache-pattern"><strong>Read More</strong></a></div></footer></article></div></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 进阶之路, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docs.advanced.way/assets/js/runtime~main.aa1c8b94.js"></script>
<script src="/docs.advanced.way/assets/js/main.8fae9188.js"></script>
</body>
</html>