(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{127:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return o})),n.d(t,"default",(function(){return u}));var a=n(3),r=n(7),c=(n(0),n(269)),l={title:"\u7f13\u5b58"},i={unversionedId:"framework/mybatis/mybatis/Cache",id:"framework/mybatis/mybatis/Cache",isDocsHomePage:!1,title:"\u7f13\u5b58",description:"Cache",source:"@site/docs/framework/mybatis/mybatis/Cache.md",slug:"/framework/mybatis/mybatis/Cache",permalink:"/docs.advanced.way/docs/framework/mybatis/mybatis/Cache",editUrl:"https://github.com/Goldwood1024/docs.advanced.way/docs/docs/framework/mybatis/mybatis/Cache.md",version:"current",lastUpdatedAt:1616131278,formattedLastUpdatedAt:"3/19/2021",sidebar:"Mybatis",previous:{title:"\u52a8\u6001 SQL",permalink:"/docs.advanced.way/docs/framework/mybatis/mybatis/\u52a8\u6001 SQL"},next:{title:"\u63d2\u4ef6",permalink:"/docs.advanced.way/docs/framework/mybatis/mybatis/\u63d2\u4ef6"}},o=[{value:"Cache",id:"cache",children:[]},{value:"\u4e00\u7ea7\u7f13\u5b58",id:"\u4e00\u7ea7\u7f13\u5b58",children:[{value:"\u5173\u95ed\u7f13\u5b58",id:"\u5173\u95ed\u7f13\u5b58",children:[]},{value:"\u7f13\u5b58\u539f\u7406",id:"\u7f13\u5b58\u539f\u7406",children:[]},{value:"PerpetualCache",id:"perpetualcache",children:[]}]},{value:"\u4e8c\u7ea7\u7f13\u5b58",id:"\u4e8c\u7ea7\u7f13\u5b58",children:[{value:"\u542f\u7528\u4e8c\u7ea7\u7f13\u5b58",id:"\u542f\u7528\u4e8c\u7ea7\u7f13\u5b58",children:[]},{value:"Cache \u5c5e\u6027",id:"cache-\u5c5e\u6027",children:[]},{value:"\u7f13\u5b58\u539f\u7406",id:"\u7f13\u5b58\u539f\u7406-1",children:[]}]},{value:"\u81ea\u5b9a\u4e49\u7f13\u5b58",id:"\u81ea\u5b9a\u4e49\u7f13\u5b58",children:[]},{value:"\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e0b\u7f13\u5b58\u95ee\u9898",id:"\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e0b\u7f13\u5b58\u95ee\u9898",children:[]},{value:"\u53c2\u8003",id:"\u53c2\u8003",children:[]}],b={toc:o};function u(e){var t=e.components,l=Object(r.a)(e,["components"]);return Object(c.b)("wrapper",Object(a.a)({},b,l,{components:t,mdxType:"MDXLayout"}),Object(c.b)("h2",{id:"cache"},"Cache"),Object(c.b)("p",null,"MyBatis \u5185\u7f6e\u4e86\u4e00\u4e2a\u5f3a\u5927\u7684\u4e8b\u52a1\u6027\u67e5\u8be2\u7f13\u5b58\u673a\u5236\uff0c\u5b83\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u914d\u7f6e\u548c\u5b9a\u5236"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"\u6620\u5c04\u8bed\u53e5\u6587\u4ef6\u4e2d\u7684\u6240\u6709 select \u8bed\u53e5\u7684\u7ed3\u679c\u5c06\u4f1a\u88ab\u7f13\u5b58\u3002")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"\u6620\u5c04\u8bed\u53e5\u6587\u4ef6\u4e2d\u7684\u6240\u6709 insert\u3001update \u548c delete \u8bed\u53e5\u4f1a\u5237\u65b0\u7f13\u5b58\u3002")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"\u7f13\u5b58\u4f1a\u4f7f\u7528\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7b97\u6cd5\uff08LRU, Least Recently Used\uff09\u7b97\u6cd5\u6765\u6e05\u9664\u4e0d\u9700\u8981\u7684\u7f13\u5b58\u3002")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"\u7f13\u5b58\u4e0d\u4f1a\u5b9a\u65f6\u8fdb\u884c\u5237\u65b0\uff08\u4e5f\u5c31\u662f\u8bf4\uff0c\u6ca1\u6709\u5237\u65b0\u95f4\u9694\uff09\u3002")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"\u7f13\u5b58\u4f1a\u4fdd\u5b58\u5217\u8868\u6216\u5bf9\u8c61\uff08\u65e0\u8bba\u67e5\u8be2\u65b9\u6cd5\u8fd4\u56de\u54ea\u79cd\uff09\u7684 1024 \u4e2a\u5f15\u7528\u3002")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"\u7f13\u5b58\u4f1a\u88ab\u89c6\u4e3a\u8bfb/\u5199\u7f13\u5b58\uff0c\u8fd9\u610f\u5473\u7740\u83b7\u53d6\u5230\u7684\u5bf9\u8c61\u5e76\u4e0d\u662f\u5171\u4eab\u7684\uff0c\u53ef\u4ee5\u5b89\u5168\u5730\u88ab\u8c03\u7528\u8005\u4fee\u6539\uff0c\u800c\u4e0d\u5e72\u6270\u5176\u4ed6\u8c03\u7528\u8005\u6216\u7ebf\u7a0b\u6240\u505a\u7684\u6f5c\u5728\u4fee\u6539"))),Object(c.b)("h2",{id:"\u4e00\u7ea7\u7f13\u5b58"},"\u4e00\u7ea7\u7f13\u5b58"),Object(c.b)("p",null,"Mybatis\u7684\u4e00\u7ea7\u7f13\u5b58\u4e0d\u9700\u8981\u4efb\u4f55\u914d\u7f6e\uff0c\u5728\u6bcf\u4e00\u4e2a SqlSession \u5f53\u4e2d\u90fd\u6709\u4e00\u4e2a\u4e00\u7ea7\u7f13\u5b58\u533a\uff0c\u4f5c\u7528\u8303\u56f4\u662f SqlSession \u3002"),Object(c.b)("p",null,Object(c.b)("img",{src:n(369).default})),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"MyBatis\u4e00\u7ea7\u7f13\u5b58\u7684\u751f\u547d\u5468\u671f\u548cSqlSession\u4e00\u81f4\u3002"),Object(c.b)("li",{parentName:"ul"},"MyBatis\u4e00\u7ea7\u7f13\u5b58\u5185\u90e8\u8bbe\u8ba1\u7b80\u5355\uff0c\u53ea\u662f\u4e00\u4e2a\u6ca1\u6709\u5bb9\u91cf\u9650\u5b9a\u7684HashMap\uff0c\u5728\u7f13\u5b58\u7684\u529f\u80fd\u6027\u4e0a\u6709\u6240\u6b20\u7f3a\u3002"),Object(c.b)("li",{parentName:"ul"},"MyBatis\u7684\u4e00\u7ea7\u7f13\u5b58\u6700\u5927\u8303\u56f4\u662fSqlSession\u5185\u90e8\uff0c\u6709\u591a\u4e2aSqlSession\u6216\u8005\u5206\u5e03\u5f0f\u7684\u73af\u5883\u4e0b\uff0c\u6570\u636e\u5e93\u5199\u64cd\u4f5c\u4f1a\u5f15\u8d77\u810f\u6570\u636e\uff0c\u5efa\u8bae\u8bbe\u5b9a\u7f13\u5b58\u7ea7\u522b\u4e3aStatement")),Object(c.b)("h3",{id:"\u5173\u95ed\u7f13\u5b58"},"\u5173\u95ed\u7f13\u5b58"),Object(c.b)("p",null,"\u9ed8\u8ba4\u4e0b ",Object(c.b)("inlineCode",{parentName:"p"},"select")," \u4f1a\u5f00\u542f\u7f13\u5b58\uff0c \u4f7f\u7528 ",Object(c.b)("inlineCode",{parentName:"p"},"flushCache")," \u5173\u95ed\u7f13\u5b58"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-xml"},'\x3c!-- \u5173\u95ed\u4e00\u7ea7\u7f13\u5b58 --\x3e\n<select flushCache="true">\n    \x3c!-- \u6bcf\u6b21\u67e5\u8be2\u90fd\u6e05\u7a7a\u7f13\u5b58 --\x3e\n<select/>\n')),Object(c.b)("h3",{id:"\u7f13\u5b58\u539f\u7406"},"\u7f13\u5b58\u539f\u7406"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-java"},'// DefaultSqlSession\n@Override\npublic void select(String statement, Object parameter, RowBounds rowBounds, ResultHandler handler) {\n    try {\n      MappedStatement ms = configuration.getMappedStatement(statement);\n      // \u6267\u884c\u67e5\u8be2\n      executor.query(ms, wrapCollection(parameter), rowBounds, handler);\n    } catch (Exception e) {\n      throw ExceptionFactory.wrapException("Error querying database.  Cause: " + e, e);\n    } finally {\n      ErrorContext.instance().reset();\n    }\n}\n\n// BaseExecutor\n@Override\npublic <E> List<E> query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler) throws SQLException {\n    BoundSql boundSql = ms.getBoundSql(parameter);\n    // \u6784\u5efa CacheKey\n    CacheKey key = createCacheKey(ms, parameter, rowBounds, boundSql);\n    return query(ms, parameter, rowBounds, resultHandler, key, boundSql);\n}\n\npublic <E> List<E> query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException {\n    ...\n    // \u67e5\u8be2\u662f\u5426\u6709\u7f13\u5b58\n    list = resultHandler == null ? (List<E>) localCache.getObject(key) : null;\n    if (list != null) {\n        // \u4ece\u7f13\u5b58\u4e2d\u53d6\u503c\n        handleLocallyCachedOutputParameters(ms, key, parameter, boundSql);\n    } else {\n        // \u67e5\u8be2\u6570\u636e\u5e93\n        list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql);\n    }\n}\n\n@Override\npublic int update(MappedStatement ms, Object parameter) throws SQLException {\n    ErrorContext.instance().resource(ms.getResource()).activity("executing an update").object(ms.getId());\n    if (closed) {\n      throw new ExecutorException("Executor was closed.");\n    }\n    // \u6e05\u9664\u7f13\u5b58\n    clearLocalCache();\n    return doUpdate(ms, parameter);\n}\n\n@Override\npublic void clearLocalCache() {\n    if (!closed) {\n      localCache.clear();\n      localOutputParameterCache.clear();\n    }\n}\n')),Object(c.b)("p",null,"\u53ea\u8981\u4e24\u6761SQL\u7684\u4e0b\u5217\u4e94\u4e2a\u503c\u76f8\u540c\uff0c\u5373\u53ef\u4ee5\u8ba4\u4e3a\u662f\u76f8\u540c\u7684SQL"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"Statement Id + Offset + Limmit + Sql + Params")),Object(c.b)("h3",{id:"perpetualcache"},"PerpetualCache"),Object(c.b)("blockquote",null,Object(c.b)("p",{parentName:"blockquote"},"perpetual ","[p\u0259\u02c8pet\u0283u\u0259l]")),Object(c.b)("p",null,"\u9ed8\u8ba4\u7684\u7f13\u5b58\u5b9e\u73b0"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-java"},'public class PerpetualCache implements Cache {\n\n  private final String id;\n\n// \u7f13\u5b58\u5bb9\u5668 HashMap\n  private final Map<Object, Object> cache = new HashMap<>();\n\n  public PerpetualCache(String id) {\n    this.id = id;\n  }\n\n  @Override\n  public String getId() {\n    return id;\n  }\n\n  @Override\n  public int getSize() {\n    return cache.size();\n  }\n\n  @Override\n  public void putObject(Object key, Object value) {\n    cache.put(key, value);\n  }\n\n  @Override\n  public Object getObject(Object key) {\n    return cache.get(key);\n  }\n\n  @Override\n  public Object removeObject(Object key) {\n    return cache.remove(key);\n  }\n\n  @Override\n  public void clear() {\n    cache.clear();\n  }\n\n  @Override\n  public boolean equals(Object o) {\n    if (getId() == null) {\n      throw new CacheException("Cache instances require an ID.");\n    }\n    if (this == o) {\n      return true;\n    }\n    if (!(o instanceof Cache)) {\n      return false;\n    }\n\n    Cache otherCache = (Cache) o;\n    return getId().equals(otherCache.getId());\n  }\n\n  @Override\n  public int hashCode() {\n    if (getId() == null) {\n      throw new CacheException("Cache instances require an ID.");\n    }\n    return getId().hashCode();\n  }\n\n}\n')),Object(c.b)("h2",{id:"\u4e8c\u7ea7\u7f13\u5b58"},"\u4e8c\u7ea7\u7f13\u5b58"),Object(c.b)("p",null,"\u4e8c\u7ea7\u7f13\u5b58\u662f mapper \u6620\u5c04\u7ea7\u522b\u7684\u7f13\u5b58\uff0c\u591a\u4e2a SqlSession \u53bb\u64cd\u4f5c\u540c\u4e00\u4e2a Mapper \u6620\u5c04\u7684 sql \u8bed\u53e5\uff0c\u591a\u4e2a SqlSession\u53ef\u4ee5\u5171\u7528\u4e8c\u7ea7\u7f13\u5b58\uff0c\u4e8c\u7ea7\u7f13\u5b58\u662f\u8de8 SqlSession \u7684\u3002"),Object(c.b)("p",null,"\u7279\u70b9:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"MyBatis\u7684\u4e8c\u7ea7\u7f13\u5b58\u76f8\u5bf9\u4e8e\u4e00\u7ea7\u7f13\u5b58\u6765\u8bf4\uff0c\u5b9e\u73b0\u4e86SqlSession\u4e4b\u95f4\u7f13\u5b58\u6570\u636e\u7684\u5171\u4eab\uff0c\u540c\u65f6\u7c92\u5ea6\u66f4\u52a0\u7684\u7ec6\uff0c\u80fd\u591f\u5230namespace\u7ea7\u522b\uff0c\u901a\u8fc7Cache\u63a5\u53e3\u5b9e\u73b0\u7c7b\u4e0d\u540c\u7684\u7ec4\u5408\uff0c\u5bf9Cache\u7684\u53ef\u63a7\u6027\u4e5f\u66f4\u5f3a")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"\u5728\u5206\u5e03\u5f0f\u73af\u5883\u4e0b\uff0c\u7531\u4e8e\u9ed8\u8ba4\u7684MyBatis Cache\u5b9e\u73b0\u90fd\u662f\u57fa\u4e8e\u672c\u5730\u7684\uff0c\u5206\u5e03\u5f0f\u73af\u5883\u4e0b\u5fc5\u7136\u4f1a\u51fa\u73b0\u8bfb\u53d6\u5230\u810f\u6570\u636e\uff0c\u9700\u8981\u4f7f\u7528\u96c6\u4e2d\u5f0f\u7f13\u5b58\u5c06MyBatis\u7684Cache\u63a5\u53e3\u5b9e\u73b0\uff0c\u6709\u4e00\u5b9a\u7684\u5f00\u53d1\u6210\u672c\uff0c\u76f4\u63a5\u4f7f\u7528Redis\u3001Memcached\u7b49\u5206\u5e03\u5f0f\u7f13\u5b58\u53ef\u80fd\u6210\u672c\u66f4\u4f4e\uff0c\u5b89\u5168\u6027\u4e5f\u66f4\u9ad8"))),Object(c.b)("h3",{id:"\u542f\u7528\u4e8c\u7ea7\u7f13\u5b58"},"\u542f\u7528\u4e8c\u7ea7\u7f13\u5b58"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-xml"},"\x3c!-- \u542f\u7528\u4e8c\u7ea7\u7f13\u5b58 --\x3e\n<cache/>\n")),Object(c.b)("h3",{id:"cache-\u5c5e\u6027"},"Cache \u5c5e\u6027"),Object(c.b)("table",null,Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",{parentName:"tr",align:null},"\u53c2\u6570\u540d"),Object(c.b)("th",{parentName:"tr",align:null},"\u8bf4\u660e"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",{parentName:"tr",align:null},"type"),Object(c.b)("td",{parentName:"tr",align:null},"\u6307\u5b9a\u7f13\u5b58\uff08cache\uff09\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u578b\uff0c\u5f53\u9700\u8981\u548cehcache\u6574\u5408\u65f6\u66f4\u6539\u8be5\u53c2\u6570\u503c\u5373\u53ef\u3002")),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",{parentName:"tr",align:null},"flushInterval"),Object(c.b)("td",{parentName:"tr",align:null},"\u5237\u65b0\u95f4\u9694\u3002\u53ef\u88ab\u8bbe\u7f6e\u4e3a\u4efb\u610f\u7684\u6b63\u6574\u6570\uff0c\u5355\u4f4d\u6beb\u79d2\u3002\u9ed8\u8ba4\u4e0d\u8bbe\u7f6e\u3002")),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",{parentName:"tr",align:null},"size"),Object(c.b)("td",{parentName:"tr",align:null},"\u5f15\u7528\u6570\u76ee\u3002\u53ef\u88ab\u8bbe\u7f6e\u4e3a\u4efb\u610f\u6b63\u6574\u6570\uff0c\u7f13\u5b58\u7684\u5bf9\u8c61\u6570\u76ee\u7b49\u4e8e\u8fd0\u884c\u73af\u5883\u7684\u53ef\u7528\u5185\u5b58\u8d44\u6e90\u6570\u76ee\u3002\u9ed8\u8ba4\u662f1024\u3002")),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",{parentName:"tr",align:null},"readOnly"),Object(c.b)("td",{parentName:"tr",align:null},"\u53ea\u8bfb\uff0ctrue\u6216false\u3002\u53ea\u8bfb\u7684\u7f13\u5b58\u4f1a\u7ed9\u6240\u6709\u7684\u8c03\u7528\u8005\u8fd4\u56de\u7f13\u5b58\u5bf9\u8c61\u7684\u76f8\u540c\u5b9e\u4f8b\u3002\u9ed8\u8ba4\u662ffalse\u3002")),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",{parentName:"tr",align:null},"eviction"),Object(c.b)("td",{parentName:"tr",align:null},"\u7f13\u5b58\u6536\u56de\u7b56\u7565\u3002LRU\uff08\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\uff09\uff0cFIFO\uff08\u5148\u8fdb\u5148\u51fa\uff09\uff0cSOFT\uff08 \u8f6f\u5f15\u7528\uff09\uff0cWEAK\uff08 \u5f31\u5f15\u7528\uff09\u3002\u9ed8\u8ba4\u662f LRU\u3002")))),Object(c.b)("h3",{id:"\u7f13\u5b58\u539f\u7406-1"},"\u7f13\u5b58\u539f\u7406"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-java"},'// DefaultSqlSessionFactory\nprivate SqlSession openSessionFromDataSource(ExecutorType execType, TransactionIsolationLevel level, boolean autoCommit) {\n    Transaction tx = null;\n    try {\n      // \u8fd4\u56de\u6267\u884c\u5668 \u5982\u679c\u5f00\u542f\u4e86\u4e8c\u7ea7\u7f13\u5b58 \u8fd4\u56de CachingExecutor\n      final Executor executor = configuration.newExecutor(tx, execType);\n      return new DefaultSqlSession(configuration, executor, autoCommit);\n    } catch (Exception e) {\n      closeTransaction(tx); // may have fetched a connection so lets call close()\n      throw ExceptionFactory.wrapException("Error opening session.  Cause: " + e, e);\n    } finally {\n      ErrorContext.instance().reset();\n    }\n}\n\n// Configuration\npublic Executor newExecutor(Transaction transaction, ExecutorType executorType) {\n    ...\n    // \u5f00\u542f\u4e86\u4e8c\u7ea7\u7f13\u5b58\n    if (cacheEnabled) {\n      executor = new CachingExecutor(executor);\n    }\n    executor = (Executor) interceptorChain.pluginAll(executor);\n    return executor;\n}\n\n\n// CachingExecutor\nprivate final TransactionalCacheManager tcm = new TransactionalCacheManager();\n\npublic <E> List<E> query(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler) throws SQLException {\n    BoundSql boundSql = ms.getBoundSql(parameterObject);\n    // \u521b\u5efa CacheKey\n    CacheKey key = createCacheKey(ms, parameterObject, rowBounds, boundSql);\n    return query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);\n}\n\npublic <E> List<E> query(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)\n      throws SQLException {\n    // \u83b7\u5f97\u5728\u914d\u7f6e\u521d\u59cb\u5316\u65f6\u8d4b\u4e88\u7684Cache\n    Cache cache = ms.getCache();\n    if (cache != null) {\n    // \u5224\u65ad\u662f\u5426\u9700\u8981\u5237\u65b0\u7f13\u5b58\n      flushCacheIfRequired(ms);\n      if (ms.isUseCache() && resultHandler == null) {\n        // \u5904\u7406\u5b58\u50a8\u8fc7\u7a0b\n        ensureNoOutParams(ms, boundSql);\n        // \u4ece TransactionalCache \u83b7\u53d6 Cache \u503c\n        List<E> list = (List<E>) tcm.getObject(cache, key);\n        // \u672a\u547d\u4e2d\n        if (list == null) {\n            // \u67e5\u8be2\u6570\u636e\u5e93\n          list = delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);\n          // \u653e\u5165\u7f13\u5b58\u4e2d\n          tcm.putObject(cache, key, list); // issue #578 and #116\n        }\n        return list;\n      }\n    }\n    return delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);\n}\n\nprivate void flushCacheIfRequired(MappedStatement ms) {\n    Cache cache = ms.getCache();\n    // insert/update/delte \u9700\u8981\u5237\u65b0\u7f13\u5b58\n    if (cache != null && ms.isFlushCacheRequired()) {\n      tcm.clear(cache);\n    }\n}\n\n@Override\npublic void commit(boolean required) throws SQLException {\n    delegate.commit(required);\n    tcm.commit();\n}\n\n\n// TransactionalCache\nprivate final Set<Object> entriesMissedInCache;\n\n@Override\npublic Object getObject(Object key) {\n    Object object = delegate.getObject(key);\n    if (object == null) {\n        // \u672a\u627e\u5230\u653e\u5165 Miss Set\n        entriesMissedInCache.add(key);\n    }\n    ...\n}\n\n@Override\npublic void putObject(Object key, Object object) {\n    entriesToAddOnCommit.put(key, object);\n}\n\npublic void commit() {\n    for (TransactionalCache txCache : transactionalCaches.values()) {\n      txCache.commit();\n    }\n}\n')),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-java"},"Cache cache = ms.getCache()\n")),Object(c.b)("p",null,"\u672c\u8d28\u4e0a\u662f\u88c5\u9970\u5668\u6a21\u5f0f\u7684\u4f7f\u7528\uff0c\u5177\u4f53\u7684\u88c5\u9970\u94fe\u662f\n",Object(c.b)("inlineCode",{parentName:"p"},"SynchronizedCache -> LoggingCache -> SerializedCache -> LruCache -> PerpetualCache")),Object(c.b)("p",null,"\u4ee5\u4e0b\u662f\u5177\u4f53\u8fd9\u4e9bCache\u5b9e\u73b0\u7c7b\u7684\u4ecb\u7ecd\uff0c\u4ed6\u4eec\u7684\u7ec4\u5408\u4e3aCache\u8d4b\u4e88\u4e86\u4e0d\u540c\u7684\u80fd\u529b"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"SynchronizedCache\uff1a\u540c\u6b65Cache\uff0c\u5b9e\u73b0\u6bd4\u8f83\u7b80\u5355\uff0c\u76f4\u63a5\u4f7f\u7528synchronized\u4fee\u9970\u65b9\u6cd5\u3002"),Object(c.b)("li",{parentName:"ul"},"LoggingCache\uff1a\u65e5\u5fd7\u529f\u80fd\uff0c\u88c5\u9970\u7c7b\uff0c\u7528\u4e8e\u8bb0\u5f55\u7f13\u5b58\u7684\u547d\u4e2d\u7387\uff0c\u5982\u679c\u5f00\u542f\u4e86DEBUG\u6a21\u5f0f\uff0c\u5219\u4f1a\u8f93\u51fa\u547d\u4e2d\u7387\u65e5\u5fd7\u3002"),Object(c.b)("li",{parentName:"ul"},"SerializedCache\uff1a\u5e8f\u5217\u5316\u529f\u80fd\uff0c\u5c06\u503c\u5e8f\u5217\u5316\u540e\u5b58\u5230\u7f13\u5b58\u4e2d\u3002\u8be5\u529f\u80fd\u7528\u4e8e\u7f13\u5b58\u8fd4\u56de\u4e00\u4efd\u5b9e\u4f8b\u7684Copy\uff0c\u7528\u4e8e\u4fdd\u5b58\u7ebf\u7a0b\u5b89\u5168\u3002"),Object(c.b)("li",{parentName:"ul"},"LruCache\uff1a\u91c7\u7528\u4e86Lru\u7b97\u6cd5\u7684Cache\u5b9e\u73b0\uff0c\u79fb\u9664\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684Key/Value\u3002"),Object(c.b)("li",{parentName:"ul"},"PerpetualCache\uff1a \u4f5c\u4e3a\u4e3a\u6700\u57fa\u7840\u7684\u7f13\u5b58\u7c7b\uff0c\u5e95\u5c42\u5b9e\u73b0\u6bd4\u8f83\u7b80\u5355\uff0c\u76f4\u63a5\u4f7f\u7528\u4e86HashMap")),Object(c.b)("h2",{id:"\u81ea\u5b9a\u4e49\u7f13\u5b58"},"\u81ea\u5b9a\u4e49\u7f13\u5b58"),Object(c.b)("p",null,"mybatis \u7684 ",Object(c.b)("inlineCode",{parentName:"p"},"Cache")," \u5b9a\u4e49"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-java"},"package org.apache.ibatis.cache;\n\npublic interface Cache {\n  // \u83b7\u53d6\u7f13\u5b58\u7f16\u53f7\n  String getId();\n  void putObject(Object key, Object value);\n  Object getObject(Object key);\n  Object removeObject(Object key);\n  void clear();\n  int getSize();\n  default ReadWriteLock getReadWriteLock() {\n    return null;\n  }\n}\n")),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"\u5b9e\u73b0 ",Object(c.b)("inlineCode",{parentName:"li"},"Cache")," \u63a5\u53e3"),Object(c.b)("li",{parentName:"ol"},"\u6dfb\u52a0 ",Object(c.b)("inlineCode",{parentName:"li"},"<cache />")," \u5b57\u6bb5")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-xml"},'<cache type="\u81ea\u5b9a\u4e49\u5b9e\u73b0\u7c7b" />\n')),Object(c.b)("h2",{id:"\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e0b\u7f13\u5b58\u95ee\u9898"},"\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e0b\u7f13\u5b58\u95ee\u9898"),Object(c.b)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e00\u7ea7\u3001\u4e8c\u7ea7\u7f13\u5b58\u90fd\u4f7f\u7528\u7684\u662f\u672c\u5730\u7f13\u5b58\uff0c\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e0b\u6709\u53ef\u80fd\u8bfb\u5230\u810f\u6570\u636e\u3002"),Object(c.b)("p",null,"\u89e3\u51b3\u65b9\u6cd5:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"\u5173\u95ed\u4e00\u7ea7\u3001\u4e8c\u7ea7\u7f13\u5b58")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"\u4f7f\u7528\u7b2c\u4e09\u65b9\u7f13\u5b58\u7ec4\u4ef6 \u5982: Redis"))),Object(c.b)("h2",{id:"\u53c2\u8003"},"\u53c2\u8003"),Object(c.b)("p",null,Object(c.b)("a",{parentName:"p",href:"https://tech.meituan.com/2018/01/19/mybatis-cache.html"},"\u804a\u804aMyBatis\u7f13\u5b58\u673a\u5236")))}u.isMDXComponent=!0},269:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},c=Object.keys(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var b=r.a.createContext({}),u=function(e){var t=r.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=u(e.components);return r.a.createElement(b.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,c=e.originalType,l=e.parentName,b=o(e,["components","mdxType","originalType","parentName"]),s=u(n),d=a,m=s["".concat(l,".").concat(d)]||s[d]||p[d]||c;return n?r.a.createElement(m,i(i({ref:t},b),{},{components:n})):r.a.createElement(m,i({ref:t},b))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var c=n.length,l=new Array(c);l[0]=d;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var b=2;b<c;b++)l[b]=n[b];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},369:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/d76ec5fe-5ed5620725410102f6bc939d37c1e420.jpg"}}]);